ROOFLYTICS – PRODUCT REQUIREMENTS DOCUMENT (v1.0 – IMPLEMENTED)
==============================================================

PRODUCT
Rooflytics – Urban Roof Intelligence Platform

--------------------------------------------------
OVERVIEW
--------------------------------------------------
Rooflytics is an end-to-end geospatial AI system that analyzes high-resolution
RGB aerial GeoTIFF imagery to extract rooftop intelligence and estimate the
potential impact of cool-roof retrofitting.

The system performs:
• Roof segmentation from aerial imagery
• Reflectance (albedo proxy) estimation
• Thermal classification (hot vs cool roofs)
• Cooling-energy savings estimation (kWh/year)
• Cost savings estimation
• CO₂ emission reduction estimation
• GIS-ready raster exports
• Interactive visualization via frontend UI

The platform is designed to be lightweight, interpretable, and deployable on
limited hardware and free-tier cloud environments.

--------------------------------------------------
SUCCESS METRICS
--------------------------------------------------
Model & Performance
• Best-effort Dice score target (≥ 0.88 when fully trained)
• Deterministic inference pipeline
• 10k × 10k GeoTIFF inference ≤ 5 minutes (CPU/GPU dependent)

System & Deployment
• Runs within ≤ 6 GB VRAM (training/inference)
• CPU-only deployment supported
• Job-based API with reproducible outputs
• Free-tier deployable backend

--------------------------------------------------
INPUT
--------------------------------------------------
• RGB GeoTIFF aerial imagery
• Typical input size: up to 10,000 × 10,000 pixels
• Coordinate reference systems preserved during processing

--------------------------------------------------
CORE PROCESSING PIPELINE
--------------------------------------------------
1. GeoTIFF loading & metadata preservation
2. Tiling (512 × 512 patches)
3. Robust normalization (not simple x/255 scaling)
4. Roof segmentation using U-Net architecture
5. Post-processing & artifact removal
6. Reflectance estimation using luminance formulation
7. Roof-level aggregation
8. Thermal clustering (hot vs cool roofs)
9. Energy, cost, and carbon modeling
10. GIS-ready raster export

--------------------------------------------------
CRITICAL IMPLEMENTATION RULES (MANDATORY)
--------------------------------------------------

NORMALIZATION
• Do NOT rely solely on x/255 scaling
• Use:
  – ImageNet mean/std normalization (for pretrained backbones)
  – or per-image standardization
• Purpose: training stability and generalization

REFLECTANCE ESTIMATION (PHYSICALLY MEANINGFUL)
• Do NOT use mean(R, G, B)
• Use luminance formulation:
  Y = 0.2126R + 0.7152G + 0.0722B
• Acts as a proxy for roof albedo / brightness

CLUSTERING
• Always standardize reflectance features before clustering
• K-Means used for binary thermal classification
• Prevents roof size from dominating clustering

--------------------------------------------------
ENERGY, COST & CARBON MODEL
--------------------------------------------------

ENERGY MODEL (PLANNING-LEVEL)
Estimated cooling-energy reduction is computed as:

E_saved = A × Δα × G × η × T × U

Where:
• A  = roof area (m²)
• Δα = assumed reflectance improvement
• G  = solar irradiance (kW/m²)
• η  = cooling efficiency
• T  = annual sunlight hours
• U  = usage factor (scene-level)

Key constraints:
• Scene-level residential usage factor (default: 0.1)
• Maximum savings capped at 5,000 kWh per roof per year
• Prevents unrealistic household overestimation

OUTPUT UNIT:
• Energy savings → kWh/year

COST MODEL
• Cost_saved = E_saved × electricity_price

CARBON MODEL
• CO₂_offset = E_saved × emission_factor

All estimates represent potential upper-bound planning-level values,
not measured household consumption.

--------------------------------------------------
MODEL STRATEGY
--------------------------------------------------

Development Phases:

1. Scratch U-Net
   • Used for pipeline validation and debugging
   • Ensures correctness of masks and preprocessing

2. EfficientNet-Backbone U-Net (Production)
   • Faster convergence
   • Better generalization
   • Lower VRAM usage
   • Used in deployed system

Architecture supports backbone swapping without pipeline changes.

--------------------------------------------------
OUTPUTS
--------------------------------------------------

Raster Outputs (GeoTIFF):
• Raw roof prediction mask
• Cleaned roof mask
• Thermal cluster map (hot vs cool roofs)

Analytics Outputs:
• Total roofs detected
• Hot roof count
• Cool roof count
• Estimated annual energy savings
• Estimated annual cost savings
• Estimated annual CO₂ reduction

Persistence:
• Per-job analytics stored in SQLite database
• MySQL-compatible schema for future migration

--------------------------------------------------
SYSTEM ARCHITECTURE
--------------------------------------------------

Backend:
• FastAPI-based REST API
• Job-based processing model
• Modular service-oriented design

Frontend:
• Streamlit-based UI
• File upload, KPI visualization, raster overlays
• No ML logic in frontend

Database:
• SQLite (file-based, lightweight)
• One row per inference job
• Stores KPIs and modeling assumptions

--------------------------------------------------
NON-FUNCTIONAL REQUIREMENTS
--------------------------------------------------
• GPU memory usage ≤ 6 GB
• CPU-only inference supported
• Offline-capable local execution
• Modular and testable codebase
• Deterministic, reproducible results
• Clean separation of ML, API, UI, and data layers

--------------------------------------------------
DISCLAIMERS
--------------------------------------------------
• Energy and cost estimates are indicative and planning-level
• Results depend on modeling assumptions and scene context
• Not intended for household billing or regulatory decisions

--------------------------------------------------
END OF DOCUMENT
--------------------------------------------------
